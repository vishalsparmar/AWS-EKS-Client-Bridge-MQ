# Set aggressive keepalives to prevent firewall timeouts
echo 30 > /proc/sys/net/ipv4/tcp_keepalive_time      # 30 seconds
echo 10 > /proc/sys/net/ipv4/tcp_keepalive_intvl     # 10 second intervals
echo 6 > /proc/sys/net/ipv4/tcp_keepalive_probes     # 6 retries

# Verify changes
echo "New TCP settings:"
cat /proc/sys/net/ipv4/tcp_keepalive_time
cat /proc/sys/net/ipv4/tcp_keepalive_intvl
cat /proc/sys/net/ipv4/tcp_keepalive_probes


# Apply all settings at once
echo 30 > /proc/sys/net/ipv4/tcp_keepalive_time
echo 10 > /proc/sys/net/ipv4/tcp_keepalive_intvl
echo 6 > /proc/sys/net/ipv4/tcp_keepalive_probes
echo 1 > /proc/sys/net/ipv4/tcp_tw_reuse
echo 30 > /proc/sys/net/ipv4/tcp_fin_timeout
echo 1 > /proc/sys/net/ipv4/tcp_timestamps


# 1. Apply TCP settings
echo 30 > /proc/sys/net/ipv4/tcp_fin_timeout
echo 1 > /proc/sys/net/ipv4/tcp_tw_reuse

# 2. Test rapid telnet connections
telnet <mainframe-mq-ip> 1414  # Connect then quit
telnet <mainframe-mq-ip> 1414  # Connect then quit  
telnet <mainframe-mq-ip> 1414  # Connect then quit
telnet <mainframe-mq-ip> 1414  # Should still work!
